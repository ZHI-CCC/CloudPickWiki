---
title: 结构详解|新手教程
date: 2099-03-05 21:25:02
permalink: /ui/结构详解|新手教程
categories:
  - UI界面
tags:
  - UI界面
---
# 云拾UI框架 | 新手教程

> 本教程将系统性地讲解云拾UI框架的核心结构、布局原理及交互脚本，帮助你从零开始构建动态用户界面。

## 第一章：UI配置文件结构

### 1.1 概述

云拾UI框架使用 **Yaml** 或 **JavaScript** 作为配置文件格式（本教程以Yaml为例）。所有数值单位均为 **Int**（整数）。每个UI配置文件严格包含两个核心部分：

- **`basic`** - 定义UI的基础属性和行为
- **`layout`** - 定义UI的视觉结构和层次关系

### 1.2 basic 区域详解

`basic` 区域位于配置文件的最顶端，用于声明UI的基本元数据和全局设置。

```yaml
!Segment # 【必选】UI类型声明 - 告诉云拾这是什么类型的界面
match: Hud # 【可选】显示匹配 - 指定在什么场景下显示此UI
script: |- # 【可选】JavaScript脚本 - 用于添加交互逻辑
escClose: false # 【可选】ESC关闭 - 按ESC键是否关闭此界面，默认为false
layout: # 【进入layout区域】开始定义UI结构
```

**参数说明表：**

| 参数 | 必选 | 取值示例 | 描述 |
|------|------|----------|------|
| `!Segment` | 是 | `!ContextMenu`, `!Popup` | UI类型标识符，必须以`!`开头 |
| `match` | 否 | `Hud`, `Inventory`, `箱子标题名` | UI显示的场景条件 |
| `script` | 否 | `JavaScript代码` | 全局脚本，可在整个UI中使用 |
| `escClose` | 否 | `true`, `false` | ESC键关闭行为，默认不关闭 |

### 1.3 layout 区域与核心概念

#### 什么是控件？

控件是UI界面的基本构建单元，如同建筑中的"砖块"，是屏幕上可见且可交互的图形元素。

**控件由两部分组成：**
- **控件定义**：声明控件类型（如按钮、文本等）
- **控件属性**：配置该控件的具体特征

**控件示例：**
```yaml
- !Button # 【控件定义】这是一个按钮控件
  name: 一个按钮 # 【控件属性】控件的标识名称
  horizontalAlign: Left # 【控件属性】水平对齐方式
  verticalAlign: Center # 【控件属性】垂直对齐方式
  marginTop: 0 # 【控件属性】上边距
  marginLeft: 18 # 【控件属性】左边距
  width: 120 # 【控件属性】宽度
  height: 40 # 【控件属性】高度
  text: '&x&f&0&e&6&d&8全球市场' # 【控件属性】显示文本
  fontSize: 22 # 【控件属性】字体大小
  fontFamily: "font://MiSans-Semibold.ttf" # 【控件属性】字体文件
  background: texture/全球市场/按钮背景.png # 【控件属性】背景图片
```

**通俗理解：**
- **控件定义** = 户口本上的"姓名"（你是谁）
- **控件属性** = 户口本上的"祖籍、出生日期"（你的信息）

#### 什么是容器？

容器是一种特殊控件，专门用于装载和管理其他控件，形成层级结构。

**核心属性：** `children` - 子控件列表，可以包含任意数量的控件或其他容器。

**常用容器类型对比：**

| 容器类型 | 功能描述 | 核心属性 | 布局行为 | 适用场景 |
|----------|----------|----------|----------|----------|
| `!Grid` (网格) | 通用基础容器，通常作为UI根容器 | `horizontalAlign`, `verticalAlign`, `margin` | 自由布局，子控件默认重叠在左上角 | 需要精确定位的复杂界面 |
| `!StackPanel` (堆叠面板) | 线性排列一组控件 | `orientation` (Vertical/Horizontal) | 顺序布局，自动排列不重叠 | 列表、菜单、工具栏 |

**容器类比：**
- **`!Grid`** 像 **桌子** - 物品可以随意摆放，甚至可以重叠
- **`!StackPanel`** 像 **书架** - 物品只能按顺序排列（垂直或水平）
> 更多容器请参考：[UI界面|界面类型](https://wiki.yunshimc.com/ui/界面类型)
### 1.4 相对布局：九点定位法

相对布局的核心思想：父容器提供"地盘"，子控件通过"对齐"和"边距"来确定自己在"地盘"中的位置。

#### 九点定位锚点表

父容器被虚拟划分为9个定位点，通过 `horizontalAlign` (水平对齐) 和 `verticalAlign` (垂直对齐) 的组合来选择基准点：

| | `Left` | `Center` | `Right` | `Stretch` |
|-|-|-|-|-|
| **`Top`** | 左上角对齐 | 上边中部对齐 | 右上角对齐 | 顶部拉伸 |
| **`Center`** | 左边中部对齐 | **正中心对齐** (最常用) | 右边中部对齐 | 垂直居中拉伸 |
| **`Bottom`** | 左下角对齐 | 下边中部对齐 | 右下角对齐 | 底部拉伸 |
| **`Stretch`** | 左侧拉伸 | 水平居中拉伸 | 右侧拉伸 | 填充整个容器 |

#### Stretch 模式详解

- `horizontalAlign: Stretch` - 控件宽度拉满父容器宽度（减去margin）
- `verticalAlign: Stretch` - 控件高度拉满父容器高度（减去margin）
- **适用场景**：需要占满剩余空间的布局元素

#### Margin (外边距) 的作用

在确定对齐基准点后，使用 `margin` 进行位置微调：

- `marginLeft: 10` - 离左边10单位
- `marginBottom: 5` - 离下边5单位  
- `margin: "5,10,5,10"` - 简写形式，顺序为"上,右,下,左"

### 1.5 基础示例解析

**简单居中文本示例：**
```yaml
!Segment # basic区域开始
match: Hud
script: |-
escClose: true
layout: # layout区域开始
- !Grid # 根容器，默认充满全屏
  children: # 子控件列表
  - !Grid # 子容器，作为背景板
    name: 背景板 # 控件名称，便于代码控制
    horizontalAlign: Center # 在父容器中水平居中
    verticalAlign: Center # 在父容器中垂直居中
    marginRight: 10 # 离右边10单位
    marginBottom: 10 # 离底部10单位
    width: 200 # 宽度
    height: 60 # 高度
    background: 0x80000000 # 背景色(50%透明黑色)
    children: # 背景板的子控件
    - !TextBlock # 文本控件
      text: "你好，云拾！" # 文本内容
      horizontalAlign: Center # 在背景板中水平居中
      verticalAlign: Center # 在背景板中垂直居中
      fontSize: 16 # 字体大小
```

**代码执行流程：**
1. `!Grid` 作为根容器充满全屏
2. 在 `children` 中添加子 `Grid` 容器作为背景板
3. 背景板通过居中对齐定位在屏幕中央
4. 在背景板内添加 `TextBlock` 文本控件并居中显示

### 1.6 进阶实战：右下角信息面板

**复杂示例 - 信息面板：**
```yaml
!Segment
match: Hud # 一直显示的HUD界面

layout:
- !Grid # 根容器（全屏）
  children:
  - !Grid # 信息面板背景容器
    name: 信息面板 # 命名便于代码控制
    # 定位到右下角
    horizontalAlign: Right
    verticalAlign: Bottom
    marginRight: 20 # 离右边缘20单位
    marginBottom: 20 # 离下边缘20单位
    width: 250 # 固定宽度
    height: 100 # 固定高度
    background: 0x80000000 # 半透明黑色背景

    children: # 面板内部控件
    - !TextBlock # 标题文字
      horizontalAlign: Left
      verticalAlign: Top
      marginLeft: 10
      marginTop: 8
      text: "状态信息"
      fontSize: 16
      fontForeground: 0xFFFFFF00 # 黄色文字

    - !TextBlock # 内容文字
      name: 内容文本 # 命名用于动态更新
      horizontalAlign: Center
      verticalAlign: Center # 在面板中居中
      text: "加载中..."
      fontSize: 14
      fontForeground: 0xFFFFFFFF # 白色文字
```

---

## 第二章：让UI交互 - 事件与脚本

静态UI需要通过事件和脚本才能实现交互功能。

### 2.1 事件系统基础

在任何控件下都可以添加 `events` 字段来定义事件响应：

```yaml
- !Button # 按钮控件
  horizontalAlign: Center
  verticalAlign: Center
  text: "点击我"
  width: 120
  height: 40

  events: # 事件定义开始
    attached: |- # 控件加载时触发
      // self 代表当前按钮
      self.text = "按钮准备好了"; // 修改自身文本
      Chat.send("按钮已加载完毕"); // 在聊天框发送消息

    click: |- # 点击时触发
      Chat.send("你好，云拾！"); // 发送消息
      self.text = "已点击"; // 修改自身文本
      // 通过名称控制其他控件
      信息面板.visibility = 'Collapsed'; // 隐藏信息面板
```

### 2.2 常用事件列表

| 事件名 | 触发时机 | 用途示例 | 使用频率 |
|--------|----------|----------|----------|
| `attached` | 控件被添加到界面时 | 初始化内容、开始动画 | ⭐⭐⭐⭐ |
| `click` | 鼠标点击控件时 | 执行命令、打开界面、切换状态 | ⭐⭐⭐⭐⭐ |
| `mouseEnter` | 鼠标移入控件区域时 | 显示悬停效果、高亮动画 | ⭐⭐⭐ |
| `mouseLeave` | 鼠标移出控件区域时 | 取消悬停效果、恢复状态 | ⭐⭐⭐ |
| `tick` | 每帧都触发 | 实时更新数据、动画效果 | ⭐⭐ |

> **性能提醒**：`tick` 事件每帧触发，过度使用会影响性能，请谨慎使用。(不过执行也在客户端，你可以堵玩家机器性能好👍)

> 更多事件请参考：[UI界面|控件事件](https://wiki.yunshimc.com/ui/控件事件)

---

## 第三章：必备知识与最佳实践

### 3.1 核心知识要点

#### 1. 单位系统
- 云拾中的尺寸单位（`width`, `height`, `margin`）不是像素
- 采用**自适应的相对单位**，会根据屏幕分辨率自动缩放
- **优势**：保证在不同设备和分辨率下观感一致

#### 2. 缩进规范
- **YAML语法严格依赖缩进**来标识层级关系
- **必须使用空格**进行缩进（推荐2个或4个空格）
- **严禁使用Tab键**，否则会导致解析失败,如果你的编辑器可以设置Tab使用空格就可以
- **建议**：在编辑器中显示缩进参考线，避免层级错误

#### 3. 控件命名规范
- 为需要通过代码动态控制的控件设置 `name` 属性
- 命名应具有描述性，如 `name: 血量文字`
- 在脚本中可直接通过名称访问：`血量文字.text = "100"`

#### 4. 开发流程建议
1. **先布局后脚本** - 先用容器搭建静态框架
3. **渐进式开发** - 先实现基础功能，再添加复杂交互
4. **模块化设计** - 将复杂UI拆分为多个可重用组件

### 3.2 调试技巧

- 使用 `Chat.send("调试信息")` 输出日志到聊天框
- 通过修改背景色临时可视化容器边界
- 利用控件显隐（`visibility`属性）进行问题隔离

---

> 通过本教程的学习，你已经掌握了云拾UI框架的核心概念。接下来只需查阅不同控件的属性文档和更多UI类型，即可独立创建复杂的用户界面！