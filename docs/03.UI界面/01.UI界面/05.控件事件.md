---
title: 控件事件
date: 2099-03-05 21:25:02
permalink: /ui/控件事件
categories:
  - UI界面
tags:
  - UI界面
---
# 控件事件

> 让UI从静态变为动态的交互核心

⚠️ **阅读前提示**  
请确保已阅读 **[结构详解 | 新手教程]** 中的基础概念，包括控件、容器、脚本等核心知识。

## 一、什么是事件（Event）？

事件是控件的"生命触发器"，当用户与控件交互（如点击、触摸、键盘输入等），或控件自身状态发生变化（如加载、布局改变等）时，系统会自动执行你编写的 JavaScript 脚本，从而实现动态交互与逻辑控制。

> 📌 简单理解：事件就是"在某个时机自动触发一段代码"，用来增强控件的交互性与灵活性。

## 二、事件应该写在哪里？

事件定义在具体控件（如 `TextBlock`、`Button` 等）的 `events` 字段下，采用 YAML 格式。

每个事件都有一个固定的名称（如 `attached`、`click` 等），后面跟随要执行的 JavaScript 代码。

## 三、事件基本语法示例

### 示例：控件加载时自动设置文本

```yaml
- !TextBlock
  horizontalAlign: Left
  verticalAlign: Top
  marginTop: 14
  marginLeft: 26
  fontFamily: "font://MiSans-Bold.ttf"
  events:
    attached: |-
      self.text = '全球市场';
```

### 说明：

- 这是一个文本块控件（`TextBlock`），设置了位置、对齐与字体
- 在 `events` 中定义了一个事件：`attached`
- 当该控件被添加到界面上时（即加载、显示时），会自动执行 JavaScript 代码：`self.text = '全球市场';`
- **作用**：将当前控件的文本内容设置为"全球市场"

> 📌 `self` 代表当前控件本身，通过它可以访问或修改控件属性。

## 四、有哪些事件可以绑定？

你可以在 `events` 下配置多种事件，每种事件会在特定时机自动触发，支持编写 JavaScript 逻辑。

### 事件列表一览表

| 事件名称 | 触发时机说明 |
|----------|--------------|
| `tick` | 每帧触发，类似游戏循环中的"滴答"，适合做动画或实时更新 |
| `preDraw` | 控件即将绘制前触发，可做绘制前的逻辑处理 |
| `attached` | 控件被添加到界面上时触发（控件加载、显示时） |
| `detached` | 控件从界面上移除时触发（控件销毁、隐藏时） |
| `click` | 鼠标任意键点击控件时触发 |
| `longClick` | 鼠标长按控件时触发 |
| `mouseRelease` | 鼠标任意键释放时触发 |
| `mouseLeftDown` | 鼠标左键按下时触发 |
| `mouseLeftUp` | 鼠标左键松开时触发 |
| `mouseRightDown` | 鼠标右键按下时触发 |
| `mouseRightUp` | 鼠标右键松开时触发 |
| `mouseMiddleDown` | 鼠标中键按下时触发 |
| `mouseMiddleUp` | 鼠标中键松开时触发 |
| `mouseEnter` | 鼠标进入控件区域时触发 |
| `mouseMove` | 鼠标在控件区域上移动时触发 |
| `mouseLeave` | 鼠标离开控件区域时触发 |
| `mouseWheel` | 鼠标在控件区域内滚动滚轮时触发 |
| `key` | 在控件区域内按下键盘按键时触发 |
| `scroll` | 滚轮事件（可能与 mouseWheel 类似，目前可能暂不可用） |
| `contextClick` | 上下文点击（通常是鼠标右键或特殊点击）时触发 |
| `layoutChange` | 控件布局发生变化时触发（如大小、位置改变） |
| `focusChange` | 控件获得或失去焦点时触发 |
| `createContextMenu` | 创建右键菜单时触发 |
| `touchDown` | 触摸屏设备上手指按下时触发（适用于移动端） |
| `touchUp` | 触摸屏设备上手指抬起时触发 |
| `touchMove` | 触摸屏设备上手指移动时触发 |
| `touchCancel` | 触摸操作被取消时触发 |
| `touchPointerDown` | 触摸指头按下时触发（多指触控相关） |
| `touchPointerUp` | 触摸指头松开时触发（多指触控相关） |

## 五、事件使用方法（详细步骤）

### 步骤 1：选择你要绑定事件的控件

比如 `TextBlock`（文本块）、`Button`（按钮）、`Image`（图片）等。

### 步骤 2：在控件定义中添加 `events` 字段

### 步骤 3：为事件指定名称，并编写 JavaScript 代码

代码使用 `|-` 符号表示多行文本块（保留格式），适合写稍微复杂一点的逻辑。

### 示例 1：按钮点击后修改自身文本

```yaml
- !Button
  text: 点击我
  events:
    click: |-
      Chat.send('你点击了按钮！');
      self.text = '已点击';
```

**说明：**
- 当用户点击这个按钮时，会在聊天框发出一个信息"你点击了按钮！"
- 同时，按钮上的文字会被修改为"已点击"

### 示例 2：文本控件加载后自动显示内容

```yaml
- !TextBlock
  text: ''
  horizontalAlign: Center
  verticalAlign: Center
  events:
    attached: |-
      self.text = '欢迎使用事件系统！';
```

**说明：**
- 页面加载并显示该文本块时，自动将内容设置为"欢迎使用事件系统！"

### 示例 3：鼠标悬停效果

```yaml
- !Button
  text: 悬停按钮
  background: 0xFF0000FF  # 蓝色背景
  events:
    mouseEnter: |-
      self.background = 0xFFFF0000;  # 鼠标进入变为红色
    mouseLeave: |-
      self.background = 0xFF0000FF;  # 鼠标离开恢复蓝色
```

## 六、关于 `self` 对象

在事件脚本中，你可以使用内置变量：

| 变量名 | 说明 |
|--------|------|
| `self` | 代表当前的控件对象本身，可通过它访问或修改控件属性，比如：`self.text`、`self.visible`、`self.width` 等 |

> ✅ 通过 `self`，你可以让控件在运行时"动起来"，比如改文字、隐藏显示、调整颜色等。

### self 常用属性示例：

```yaml
- !Button
  text: 动态按钮
  events:
    click: |-
      self.text = "文字已改变";      # 修改文本
      self.visible = Hidden;         # 隐藏控件
      self.width = 200;             # 修改宽度
      self.background = 0xFFFF0000; # 修改背景色
```

## 七、小结：为什么要用事件？

| 功能 | 说明 |
|------|------|
| ✅ 实现交互 | 如点击按钮触发操作、输入内容实时搜索 |
| ✅ 动态内容 | 控件加载时自动填入数据、根据状态显示不同内容 |
| ✅ 响应用户 | 支持鼠标、键盘、触摸等输入方式的响应 |
| ✅ 灵活控制 | 在布局变化、获得焦点、绘制前后等时机插入逻辑 |

> 🎯 **事件，就是让界面从"静态"变成"动态"、从"死板"变成"智能"的关键！**

## 八、常见问题

### ❓ Q：事件可以写多条吗？
✅ 可以！你可以在 `events` 下同时绑定多个事件，例如同时监听 `click` 和 `attached`。

### ❓ Q：事件中的代码是什么语言？
🟢 是 JavaScript，你可以在事件中写 JS 逻辑，操作控件、调用函数、显示提示等。

### ❓ Q：所有控件都支持所有事件吗？
✅ 是的，全部控件都支持所有事件，但个别事件可能仅适用于特定控件或平台，具体以实际渲染效果为准。

### ❓ Q：如何调试事件中的代码？
✅ 可以使用 `Chat.send("调试信息")` 在游戏聊天框中输出调试信息。

## 九、最佳实践

### 1. 性能注意事项
- `tick` 事件每帧触发，避免在其中执行复杂计算
- 及时清理不需要的事件监听，防止内存泄漏

### 2. 代码组织建议
```yaml
- !Button
  text: 功能按钮
  events:
    attached: |-
      // 初始化代码
      self.data = { count: 0 };
    
    click: |-
      // 业务逻辑代码
      self.data.count++;
      self.text = "点击次数: " + self.data.count;
    
    detached: |-
      // 清理代码
      self.data = null;
```

## 快速复制代码块

### 加载时设置文本：
```yaml
events:
  attached: |-
    self.text = '页面加载完成！';
```

### 按钮点击事件：
```yaml
events:
  click: |-
    Chat.send('按钮被点击了！');
    self.text = '已点击';
```

### 鼠标进入控件区域：
```yaml
events:
  mouseEnter: |-
    self.background = '#f0f0f0';  // 鼠标进入时变浅色背景
```

### 键盘事件处理：
```yaml
events:
  key: |-
    // event参数包含按键信息
    if (event.keyCode === RETURN) { // 回车键
      Chat.send('按下了回车键');
    }
```