---
title: PacketSender
date: 2099-03-05 21:25:02
permalink: /develop/PacketSender
categories:
  - 开发
tags:
  - 开发
---
# CloudPick PacketSender 开发文档

## 概述
PacketSender 是 CloudPick 插件提供的客户端数据包发送接口，用于实现附属插件与客户端MOD之间的自定义通信。

## 核心类
```java
yslelf.cloudpick.bukkit.api.PacketSender
```

## 数据包发送方法

### 发送自定义数据
```java
void sendCustomData(Player player, String identifier, Object... data)
void sendCustomJsonData(Player player, String identifier, Object data)
```

### 资源管理
```java
void sendAssets(Player player)
void sendResourceDownloaded(Player player)
void sendResourceReload(Player player)
void sendAssetsToAllPlayers()
```

### 外观系统
```java
void sendNeedFashion(Player player, Player targetPlayer, String model)
void sendAccessoryNeedFashion(Player player, String model)
void sendFashion(Player player, UUID uuid, String fashion)
void sendAccessoryFashion(Player player, UUID uuid, String type, String fashion)
```

### 实体模型控制
```java
void setEntityModel(Player player, UUID uuid, String matchName)
void setEntityHeadTag(Player player, UUID uuid, String matchName)
void setClientEntityHitbox(Player player, UUID uuid, float width, float height)
```

### 动画系统
```java
void setPlayerAnimation(Player player, String animation)
void setPlayerAnimation(Player player, String animation, float speed)
void removePlayerAnimation(Player player)
void setModelEntityAnimation(LivingEntity entity, String animation, int transitionTime)
void setModelEntityAnimation(LivingEntity entity, String animation, int transitionTime, float speed)
void setModelEntityAnimation(Player player, UUID entity, String animation, int transitionTime)
void setModelEntityAnimation(Player player, UUID entity, String animation, int transitionTime, float speed)
void removeModelEntityAnimation(LivingEntity entity, String animation, int transitionTime)
void removeModelEntityAnimation(Player player, UUID entity, String animation, int transitionTime)
void setEntityModelItemAnimation(LivingEntity entity, String animation)
void setEntityModelItemAnimation(LivingEntity entity, String animation, float speed)
```

### 动画控制器
```java
void setPlayerAnimationController(Player player, UUID uuid, String controllerName)
void setPlayerAnimationController(Player player, String controllerName)
void runPlayerAnimationControllerFunction(Player player, String function)
void runEntityAnimationFunction(Player player, UUID uuid, String function)
void runEntityTagFunction(Player player, UUID uuid, String function)
```

### 方块动画
```java
void setBlockAnimation(Player player, int x, int y, int z, String animation, int transitionTime, float speed)
void removeBlockAnimation(Player player, int x, int y, int z, String animation)
```

### 世界纹理
```java
void setPlayerWorldTexture(Player player, String key, Location location, float rotateX, float rotateY, float rotateZ, String path, float width, float height, float alpha, boolean z, boolean z2, UUID entity, boolean z3, double x, double y, double z4)
void setPlayerWorldTexture(Player player, String key, Location location, float rotateX, float rotateY, float rotateZ, ItemStack itemStack, float scale, boolean z, boolean z2, UUID entity, boolean z3, double x, double y, double z4)
void setPlayerWorldTexture(Player player, String key, WorldTexture worldTexture)
void removePlayerWorldTexture(Player player, String key)
void removePlayerWorldTexture(Player player, String key, boolean z)
```

### 粒子系统
```java
void addParticle(Player player, String schemeKey, String particleUUID, String posOrEntityUUID, String rotation, int lifeTime)
void addParticle(Player player, String schemeKey, String particleUUID, String posOrEntityUUID, String rotation, String translate, int lifeTime)
void removeParticle(Player player, String particleUUID)
void removeParticle(Player player, UUID entityUUID)
void clearParticle(Player player)
```

### 实体位置绑定
```java
void sendEntityLocationBind(Player player, UUID entity, UUID owner, float forward, float offsetY, float sideways, boolean z, boolean z2)
```

### UI界面控制
```java
void sendOpenGui(Player player, String guiName)
void sendCloseGui(Player player)
void sendUpdateGui(Player player, YamlConfiguration yaml)
void sendOpenHud(Player player, String hudName)
void sendRemoveHud(Player player, String hudName)
void sendChatCustomView(Player player, String fileName)
```

### 音视频播放
```java
void sendPlaySound(Player player, String soundFile, float volume, float pitch, boolean z, float x, float y, float z2)
void sendPlaySound(Player player, String soundKey, String soundFile, float volume, float pitch, boolean z, float x, float y, float z2)
void sendPlaySound(Player player, String soundKey, String soundFile, String category, float volume, float pitch, boolean z, float x, float y, float z2)
void sendStopSound(Player player, String soundKey)
void sendPlayAudio(Player player, String audioName)
void sendStopAudio(Player player, String audioName)
void sendPlayVideo(Player player, String url)
```

### 配置数据同步
```java
void sendYaml(Player player, String fileName, YamlConfiguration yaml, boolean z)
void sendYamlStr(Player player, String fileName, String yaml, boolean z)
void sendYaml(Player player, String fileName, YamlConfiguration yaml)
void sendSyncPermission(Player player, Map<String, Boolean> map)
void sendSyncPlaceholder(Player player, Map<String, String> map)
```

### 文件传输
```java
void sendFileContent(Player player, String resourceLocation, byte[] fileContent)
void sendServerFile(Player player, String resourceLocation, byte[] fileContent)
```

### 客户端脚本执行
```java
void sendRunScript(Player player, String script, boolean z)
void sendRunFunction(Player player, String str, String script, boolean z)
```

### 外部功能
```java
void sendOpenBrowser(Player player, String url)
void sendClipboardContent(Player player, String content)
```

### 路径点
```java
void addWaypoint(Player player, String waypoint, Entity entity)
```

### 槽位管理
```java
void putClientSlotItem(Player player, String slotIdentity, ItemStack itemStack)
void sendDeleteItemStackCache(Player player, String slotIdentity, boolean z)
void sendDeletePlaceholderCache(Player player, String key, boolean z)
```

### 按键注册
```java
void sendKeyRegister(Player player)
```

### 缓存管理
```java
void sendClearCache(Player player)
void sendDeleteCache(Player player)
```

### 过载控制
```java
void sendOverLoadStarted(Player player)
void sendOverLoadFinished(Player player)
```

### 世界信息
```java
void sendPlayerWorld(Player player)
```

## 工具方法

### 玩家获取
```java
List<Player> getNearPlayers(Entity entity)
List<Player> getNearPlayers(Entity entity, int range)
```

## 事件系统

### Yaml数据包事件
```java
YamlPacketEvent - 在发送Yaml数据包时触发
```

## 依赖项

### Bukkit依赖
- `Player` - 玩家对象
- `Location` - 位置对象
- `Entity` / `LivingEntity` - 实体对象
- `ItemStack` - 物品堆
- `YamlConfiguration` - YAML配置
- `NamespacedKey` - 命名空间键
- `SoundCategory` - 声音分类

## 使用示例

### 基本用法
```java
// 发送自定义数据
PacketSender.sendCustomData(player, "my_identifier", "data1", "data2");

// 设置玩家动画
PacketSender.setPlayerAnimation(player, "wave_animation");

// 播放自定义声音
PacketSender.sendPlaySound(player, "custom.sound", 1.0f, 1.0f, false, 0, 0, 0);

//如何将自己的List<String>作为参数发包给云拾
val test = listOf("foo", "bar", "whatever")
PacketSender.sendCustomData(player, packetId, *test.toTypedArray());
```

## 注意事项

1. 所有方法都是静态方法，直接通过类名调用
2. 需要确保CloudPick插件正确加载
3. 客户端需要安装对应的CloudPick客户端模组