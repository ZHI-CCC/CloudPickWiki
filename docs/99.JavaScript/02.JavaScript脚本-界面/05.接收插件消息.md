---
title: æŽ¥æ”¶æ¥è‡ªæ’ä»¶çš„æ¶ˆæ¯
date: 2099-03-05 21:25:02
permalink: /js/æŽ¥æ”¶æ¥è‡ªæ’ä»¶çš„æ¶ˆæ¯
categories:
  - è„šæœ¬
tags:
  - è„šæœ¬
---
# æŽ¥æ”¶æ¥è‡ªæ’ä»¶çš„æ¶ˆæ¯

è¯¥åŠŸèƒ½æ˜¯è¿žæŽ¥æœåŠ¡å™¨åŽç«¯ï¼ˆæ’ä»¶ï¼‰ä¸Žå®¢æˆ·ç«¯å‰ç«¯ï¼ˆUIï¼‰çš„å…³é”®æ¡¥æ¢ã€‚å®ƒå…è®¸æ‚¨çš„æ’ä»¶å°†å®žæ—¶æ•°æ®ã€æ¸¸æˆçŠ¶æ€æ›´æ–°æˆ–å…¶ä»–ä»»ä½•ä¿¡æ¯ç›´æŽ¥æŽ¨é€ç»™çŽ©å®¶çš„UIç•Œé¢ï¼Œä»Žè€Œå®žçŽ°åŠ¨æ€ã€æ•°æ®é©±åŠ¨çš„ç”¨æˆ·ç•Œé¢ã€‚

## ðŸ¤– API è¯¦è§£ä¸Žè„šæœ¬ç¤ºä¾‹

### æ ¸å¿ƒæœºåˆ¶
| ç»„ä»¶ | ç±»åž‹ | è¯´æ˜Ž |
| :--- | :--- | :--- |
| **`PacketSender.sendCustomData(player, ...)`** | æ’ä»¶ç«¯ API | åœ¨æ‚¨çš„æœåŠ¡å™¨æ’ä»¶ä¸­è°ƒç”¨æ­¤æ–¹æ³•ï¼Œå‘æŒ‡å®šçš„çŽ©å®¶å‘é€ä¸€ä¸ªå¸¦æœ‰å”¯ä¸€æ ‡è¯†ç¬¦å’Œè‡ªå®šä¹‰æ•°æ®çš„æ•°æ®åŒ…ã€‚ |
| **`events.listener` `customDataReceive(event)`** | UIç«¯äº‹ä»¶ç›‘å¬å™¨ | åœ¨ä»»ä½•UIæŽ§ä»¶çš„ `events` å—ä¸­å®šä¹‰ `listener` äº‹ä»¶ã€‚å½“æŽ¥æ”¶åˆ°æ¥è‡ªæ’ä»¶çš„è‡ªå®šä¹‰æ•°æ®åŒ…æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨åä¸º **`customDataReceive`** çš„å‡½æ•°ã€‚ |

### ç¤ºä¾‹ä¸€ï¼šå¤„ç†åŸºæœ¬æ•°æ®
æ­¤ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä»Žæ’ä»¶å‘é€å‡ ä¸ªç®€å•çš„æ•°æ®å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨UIä¸­æŽ¥æ”¶å®ƒä»¬ã€‚

#### 1. æ’ä»¶ç«¯ä»£ç  (Java/Kotlin)
```java
// åœ¨æ‚¨çš„æ’ä»¶é€»è¾‘ä¸­ï¼Œå‘çŽ©å®¶å‘é€æ•°æ®
// "xxxxx" æ˜¯è‡ªå®šä¹‰çš„æ ‡è¯†ç¬¦ï¼Œç”¨äºŽåœ¨UIç«¯è¿›è¡Œè¯†åˆ«
// "æ•°æ®1", "æ•°æ®2" æ˜¯è¦å‘é€çš„å…·ä½“å†…å®¹
PacketSender.sendCustomData(player, "xxxxx", "æ•°æ®1", "æ•°æ®2");
```

#### 2. UIç«¯ä»£ç  (YAML & JavaScript)
```yaml
- !TextBlock
  name: dataDisplay
  events:
    listener: |
      function customDataReceive(event) {
        // èŽ·å–æ•°æ®åŒ…çš„æ ‡è¯†ç¬¦
        var identifier = event.getIdentifier();
        
        // åˆ¤æ–­æ˜¯å¦æ˜¯æˆ‘ä»¬å…³å¿ƒçš„é‚£ä¸ªæ•°æ®åŒ…
        if (identifier == 'xxxxx') {
          // èŽ·å–æ•°æ®åŒ…ä¸­é™„å¸¦çš„æ‰€æœ‰æ•°æ®
          var data = event.getData();
          
          // æŒ‰é¡ºåºç´¢å¼•èŽ·å–æ•°æ®
          var a = data.get(0); // -> "æ•°æ®1"
          var b = data.get(1); // -> "æ•°æ®2"

          // åœ¨èŠå¤©æ¡†ä¸­æ‰“å°ç¬¬ä¸€ä¸ªæ•°æ®è¿›è¡ŒéªŒè¯
          Chat.send("ä»Žæ’ä»¶æ”¶åˆ°æ•°æ®: " + a);
          
          // ä¹Ÿå¯ä»¥ç”¨æ•°æ®æ›´æ–°UIæŽ§ä»¶
          dataDisplay.text = a + " | " + b;
        } 
      }
```

### ç¤ºä¾‹äºŒï¼šå¤„ç†ç»“æž„åŒ–æ•°æ® (JSON)
ä¸ºäº†ä¼ è¾“å¤æ‚çš„æ•°æ®ç»“æž„ï¼Œæœ€ä½³å®žè·µæ˜¯å…ˆåœ¨æ’ä»¶ç«¯å°†æ•°æ®å°è£…æˆJSONå­—ç¬¦ä¸²ï¼Œç„¶åŽåœ¨UIç«¯è¿›è¡Œè§£æžã€‚

#### 1. æ’ä»¶ç«¯ä»£ç  (Java/Kotlin)
```java
// å‡è®¾æ‚¨æž„å»ºäº†ä¸€ä¸ªJSONå­—ç¬¦ä¸²
String jsonData = "{\"count\": 1,\"player\":{\"name\":\"Alex\",\"stats\":{\"hp\":20,\"mp\":15}}}";

// å°†æ•´ä¸ªJSONå­—ç¬¦ä¸²ä½œä¸ºå•ä¸ªæ•°æ®é¡¹å‘é€
PacketSender.sendCustomData(player, "player_stats", jsonData);
```

#### 2. UIç«¯ä»£ç  (YAML & JavaScript)
```yaml
- !TextBlock
  name: playerStatsDisplay
  events:
    listener: |
      function customDataReceive(event) {
        var identifier = event.getIdentifier();

        if (identifier === 'player_stats') {
          var data = event.getData();
          
          // èŽ·å–JSONå­—ç¬¦ä¸²ï¼Œå› ä¸ºæˆ‘ä»¬åªå‘é€äº†ä¸€é¡¹æ•°æ®ï¼Œæ‰€ä»¥ç´¢å¼•æ˜¯0
          var jsonString = data.get(0);
          
          // ä½¿ç”¨ JSON.parse() å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºJavaScriptå¯¹è±¡
          var obj = JSON.parse(jsonString);
          
          // çŽ°åœ¨å¯ä»¥è½»æ¾è®¿é—®å¯¹è±¡ä¸­çš„ä»»ä½•æ•°æ®
          var count = obj.count;                 // -> 1
          var player = obj.player;               // -> {name: "Alex", stats: {...}}
          var name = obj.player.name;            // -> "Alex"
          var hp = obj.player.stats.hp;          // -> 20
          
          // ä¹Ÿå¯ä»¥ä½¿ç”¨æ–¹æ‹¬å·ç´¢å¼•å™¨æ¥è®¿é—®å±žæ€§
          var mp = obj["player"]["stats"]["mp"]; // -> 15

          // æ›´æ–°UIæ˜¾ç¤º
          playerStatsDisplay.text = "çŽ©å®¶: " + name + " | HP: " + hp + " | MP: " + mp;
        } 
      }
```