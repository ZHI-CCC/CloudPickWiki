---
title: ä½¿ç”¨è„šæœ¬æ§åˆ¶ç”»åˆ·
date: 2099-03-05 21:25:02
permalink: /js/ä½¿ç”¨è„šæœ¬æ§åˆ¶ç”»åˆ·
categories:
  - è„šæœ¬
tags:
  - è„šæœ¬
---
# ä½¿ç”¨è„šæœ¬æ§åˆ¶ç”»åˆ· (Brush)

é™¤äº†åœ¨ YAML ä¸­é™æ€é…ç½®ï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡ JavaScript è„šæœ¬åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºã€ä¿®æ”¹å’Œåº”ç”¨å„ç§ç”»åˆ·ï¼ˆBrushï¼‰åˆ°UIæ§ä»¶ä¸Šã€‚è¿™ä½¿å¾—å®ç°åŠ¨æ€çš„è§†è§‰æ•ˆæœï¼Œå¦‚é¢œè‰²å˜åŒ–ã€å›¾ç‰‡åˆ‡æ¢ã€åŠ¨ç”»æ§åˆ¶ç­‰æˆä¸ºå¯èƒ½ã€‚

## ğŸ¤– API è¯¦è§£ä¸è„šæœ¬ç¤ºä¾‹

### æ ¸å¿ƒæœºåˆ¶
1.  **å®ä¾‹åŒ–ç”»åˆ·**ï¼šä½¿ç”¨ `new BrushType()` è¯­æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„ç”»åˆ·å®ä¾‹ï¼Œä¾‹å¦‚ `new ColorBrush()`ã€‚
2.  **é…ç½®å±æ€§**ï¼šé€šè¿‡è®¿é—®å®ä¾‹çš„å±æ€§æ¥è®¾ç½®å…¶å‚æ•°ï¼Œä¾‹å¦‚ `colorBrush.color = 0xFFFF0000;`ã€‚
3.  **åº”ç”¨ç”»åˆ·**ï¼šå°†é…ç½®å¥½çš„ç”»åˆ·å®ä¾‹èµ‹å€¼ç»™æ§ä»¶çš„ç›¸åº”å±æ€§ï¼Œå¦‚ `self.background` æˆ– `self.foreground`ã€‚

### ç¤ºä¾‹ä¸€ï¼šåŠ¨æ€åº”ç”¨é¢œè‰²å’Œå›¾ç‰‡ç”»åˆ·
æ­¤ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªé¢œè‰²ç”»åˆ·å’Œä¸€ä¸ªå›¾ç‰‡ç”»åˆ·ï¼Œå¹¶å°†å…¶åº”ç”¨åˆ°ä¸€ä¸ª `Grid` å®¹å™¨çš„èƒŒæ™¯ä¸Šã€‚

```yaml
- !Grid
  name: grid
  events:
    attached: |
      // --- åŠ¨æ€åˆ›å»ºå¹¶åº”ç”¨ ColorBrush (çº¯è‰²ç”»åˆ·) ---
      var colorBrush = new ColorBrush();
      colorBrush.color = 0xFFFF0000; // è®¾ç½®ä¸ºçº¢è‰²
      colorBrush.alpha = 100;        // è®¾ç½®é€æ˜åº¦
      
      // å°†ç”»åˆ·åº”ç”¨åˆ°å½“å‰æ§ä»¶ (self, å³Grid) çš„èƒŒæ™¯ä¸Š
      // self.background = colorBrush;


      // --- åŠ¨æ€åˆ›å»ºå¹¶åº”ç”¨ ImageBrush (å›¾ç‰‡ç”»åˆ·) ---
      var imageBrush = new ImageBrush();
      imageBrush.source = 'texture://bb.png'; // è®¾ç½®å›¾ç‰‡æº
      imageBrush.alpha = 123;                 // è®¾ç½®é€æ˜åº¦
      
      // é‡æ–°èµ‹å€¼ä¼šè¦†ç›–ä¹‹å‰çš„èƒŒæ™¯
      self.background = imageBrush;
```

### ç¤ºä¾‹äºŒï¼šæ§åˆ¶åŠ¨æ€å›¾ç‰‡ç”»åˆ·
å¯¹äº `AnimatedImageBrush`ï¼Œæ‚¨ä¸ä»…å¯ä»¥è®¾ç½®å…¶å±æ€§ï¼Œè¿˜å¯ä»¥è°ƒç”¨æ–¹æ³•æ¥æ§åˆ¶å…¶æ’­æ”¾çŠ¶æ€ã€‚

```javascript
      // --- æ§åˆ¶ AnimatedImageBrush (åŠ¨æ€å›¾ç‰‡ç”»åˆ·) ---
      var animatedImageBrush = new AnimatedImageBrush();
      animatedImageBrush.source = 'texture://anim.gif';
      animatedImageBrush.oneShot = true; // è®¾ç½®ä¸ºåªæ’­æ”¾ä¸€æ¬¡

      // åº”ç”¨ç”»åˆ·
      self.background = animatedImageBrush;

      // æ§åˆ¶æ’­æ”¾
      animatedImageBrush.start(); // å¼€å§‹æ’­æ”¾åŠ¨ç”»
      // animatedImageBrush.stop();  // åœæ­¢æ’­æ”¾åŠ¨ç”»
      
      // æ£€æŸ¥æ’­æ”¾çŠ¶æ€
      if (animatedImageBrush.isRunning()) {
          Chat.send("åŠ¨ç”»æ­£åœ¨æ’­æ”¾ï¼");
      }
```

### ç¤ºä¾‹ä¸‰ï¼šä½¿ç”¨é«˜çº§ç”»åˆ· (RegionClipBrush)
æ­¤ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ª `RegionClipBrush` æ¥è£å‰ªå¹¶æ˜¾ç¤ºå›¾ç‰‡çš„ä¸€éƒ¨åˆ†ã€‚

```yaml
      // --- ä½¿ç”¨ RegionClipBrush (åŒºåŸŸè£å‰ªç”»åˆ·) ---
      var regionClipBrush = new RegionClipBrush();
      
      // è¿™ä¸ªç”»åˆ·æ²¡æœ‰ç‹¬ç«‹çš„brushå±æ€§ï¼Œç›´æ¥è®¾ç½®source
      regionClipBrush.source = 'texture://bb.png';
      
      // è®¾ç½®è£å‰ªåŒºåŸŸçš„åæ ‡å’Œå°ºå¯¸
      regionClipBrush.clipLeft = 10;   // ä»å·¦è¾¹10åƒç´ å¤„å¼€å§‹
      regionClipBrush.clipTop = 20;    // ä»é¡¶éƒ¨20åƒç´ å¤„å¼€å§‹
      regionClipBrush.clipWidth = 100; // è£å‰ªå®½åº¦100åƒç´ 
      regionClipBrush.clipHeight = 100;// è£å‰ªé«˜åº¦100åƒç´ 
      
      // å°†è£å‰ªåçš„ç”»åˆ·åº”ç”¨åˆ°Gridçš„å‰æ™¯ä¸Š
      grid.foreground = regionClipBrush;
```

## ğŸ•¶æ»¤é•œå±æ€§
### BlendModeColorFilter
1.  è¯¥å±æ€§å¯ä»¥ç»™ä»»ä½•ç”»åˆ·æ·»åŠ æ»¤é•œã€‚  

### ç¤ºä¾‹ï¼šç»™ColorBrushæ·»åŠ æ»¤é•œ
```javascript
var brush = new ColorBrush();
var blendModeColorFilter = new BlendModeColorFilter(0xFFFF0000,'SRC_OVER');
brush.setColorFilter(blendModeColorFilter);
```

### è¯¦ç»†è¯´æ˜

### 1. **åˆ›å»ºåŸºç¡€ç¬”åˆ·**
```javascript
var brush = new ColorBrush();
```
åˆ›å»ºä¸€ä¸ªçº¯è‰²ç¬”åˆ·å¯¹è±¡ã€‚

### 2. **åˆ›å»ºæ··åˆæ¨¡å¼é¢œè‰²æ»¤é•œ**
```javascript
var blendModeColorFilter = new BlendModeColorFilter(0xFFFF0000, 'SRC_OVER');
```
- **0xFFFF0000**ï¼šè¡¨ç¤ºARGBæ ¼å¼çš„é¢œè‰²å€¼
  - `FF`ï¼šå®Œå…¨ä¸é€æ˜ï¼ˆAlphaé€šé“ï¼‰
  - `FF0000`ï¼šçº¯çº¢è‰²ï¼ˆRGBé€šé“ï¼‰
- **'SRC_OVER'**ï¼šæŒ‡å®šæ··åˆæ¨¡å¼
  - è¿™æ˜¯æœ€å¸¸è§çš„Porter-Duffæ··åˆæ¨¡å¼
  - å«ä¹‰ï¼šæºå›¾åƒï¼ˆçº¢è‰²ï¼‰ç»˜åˆ¶åœ¨ç›®æ ‡å›¾åƒä¹‹ä¸Š

### 3. **åº”ç”¨æ»¤é•œåˆ°ç¬”åˆ·**
```javascript
brush.setColorFilter(blendModeColorFilter);
```
å°†åˆ›å»ºçš„é¢œè‰²æ»¤é•œè®¾ç½®åˆ°ç¬”åˆ·ä¸Šã€‚

## æ··åˆæ¨¡å¼è¯´æ˜ï¼š

æ³¨é‡Šä¸­æåˆ°çš„æ¨¡å¼æ˜¯æ ‡å‡†çš„Porter-Duffåˆæˆæ“ä½œï¼š
- **CLEAR**ï¼šæ¸…é™¤ç›®æ ‡åŒºåŸŸ
- **SRC**ï¼šåªæ˜¾ç¤ºæºå›¾åƒ
- **DST**ï¼šåªæ˜¾ç¤ºç›®æ ‡å›¾åƒ
- **SRC_OVER**ï¼šæºå›¾åƒè¦†ç›–åœ¨ç›®æ ‡å›¾åƒä¸Šï¼ˆé»˜è®¤ï¼‰
- **DST_OVER**ï¼šç›®æ ‡å›¾åƒè¦†ç›–åœ¨æºå›¾åƒä¸Š
- **SRC_IN**ï¼šåªæ˜¾ç¤ºæºå›¾åƒå’Œç›®æ ‡å›¾åƒé‡å çš„éƒ¨åˆ†
- **DST_IN**ï¼šåªæ˜¾ç¤ºç›®æ ‡å›¾åƒå’Œæºå›¾åƒé‡å çš„éƒ¨åˆ†

## å®é™…æ•ˆæœï¼š

ä½¿ç”¨è¿™æ®µä»£ç åï¼Œ`brush`ç¬”åˆ·ä¼šï¼š
1. å°†ç»˜åˆ¶çš„ä»»ä½•å†…å®¹éƒ½åº”ç”¨çº¢è‰²æ»¤é•œ
2. ä½¿ç”¨`SRC_OVER`æ··åˆæ¨¡å¼è¿›è¡Œåˆæˆ
3. æœ€ç»ˆæ•ˆæœï¼šä½¿ç”¨è¿™ä¸ªç¬”åˆ·ç»˜åˆ¶æ—¶ï¼Œä¼šåœ¨ç°æœ‰å†…å®¹ä¸Šè¦†ç›–ä¸€å±‚åŠé€æ˜çš„çº¢è‰²ï¼ˆä½†ç”±äºAlphaæ˜¯FFï¼Œå®é™…ä¸Šæ˜¯ä¸é€æ˜çš„çº¯çº¢è‰²è¦†ç›–ï¼‰