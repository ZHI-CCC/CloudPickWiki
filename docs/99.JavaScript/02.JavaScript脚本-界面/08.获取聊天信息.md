---
title: 获取聊天信息
date: 2099-03-05 21:25:02
permalink: /js/获取聊天信息
categories:
  - 脚本
tags:
  - 脚本
---
# 获取聊天信息

这是一个全局UI事件，当游戏客户端接收到任何聊天信息时（无论是玩家发送的、服务器公告还是系统消息），该事件都会被触发。通过监听此事件，您可以捕获聊天内容并据此执行UI逻辑，例如实现自定义的聊天显示窗口、关键词高亮或消息通知等功能。

## 🤖 API 详解与脚本示例

监听聊天事件有两种方式：一种是能获取详细参数的完整写法，另一种是仅用于触发响应的简略写法。

### 方式一：完整写法 (通过 `listener`)
这种方式功能更强大，可以获取到聊天消息的具体内容和类型。

#### 核心机制
| 组件 | 类型 | 说明 |
| :--- | :--- | :--- |
| **`events.listener` `chatReceive(event)`** | UI端事件监听器 | 在控件的 `events` 块中定义 `listener` 事件。当接收到聊天消息时，系统会自动调用名为 **`chatReceive`** 的函数，并传入包含消息详情的 `event` 对象。 |

#### 示例代码
```yaml
- !Grid
  events:
    listener: |
      function chatReceive(event) {
        // 当接收到聊天消息时，此函数会自动执行
        
        // 使用 event.getType() 获取消息类型 (例如: "Player", "System")
        var type = event.getType();
        
        // 使用 event.getMessage() 获取完整的聊天消息字符串
        var message = event.getMessage();
        
        // 示例：在控制台打印捕获到的消息详情
        // 注意：Chat.sendSelf 仅用于演示，实际使用中可能会造成消息循环
        Chat.sendSelf("捕获到 [" + type + "] 消息: " + message);
      }
```

### 方式二：简略写法 (直接使用事件名)
这种方式代码更简洁，适用于不需要关心聊天内容，只希望在有新消息时触发一个简单动作的场景。

#### 核心机制
| 组件 | 类型 | 说明 |
| :--- | :--- | :--- |
| **`events.chatReceive`** | UI端事件监听器 | 直接在 `events` 块中定义 `chatReceive` 事件。当接收到聊天消息时，系统会执行其对应的脚本，但**不会**传入任何参数。 |

#### 示例代码
```yaml
- !Grid
  events:
    chatReceive: |
      # 这种写法无法访问 event 对象，也就无法获取消息内容
      # 仅在接收到任何聊天消息时执行这里的代码
      Chat.sendSelf('刚刚有新的聊天消息！');
```

### 🔍 两种写法的区别
*   **完整写法 (`listener` -> `chatReceive(event)`)**：
    *   **优点**：可以访问 `event` 对象，从而获取消息的**内容** (`getMessage`) 和**类型** (`getType`)。
    *   **适用场景**：需要根据聊天内容进行判断和处理的复杂逻辑，如制作自定义聊天框、关键词检测、消息过滤等。

*   **简略写法 (`chatReceive:`)**：
    *   **优点**：语法非常简洁。
    *   **缺点**：**无法获取**消息的任何具体信息。
    *   **适用场景**：仅用于触发一个与消息内容无关的通用通知，例如播放新消息提示音、显示一个闪烁的图标等。