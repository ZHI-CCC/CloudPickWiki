---
title: 脚本创建动画
date: 2099-03-05 21:25:02
permalink: /js/脚本创建动画
categories:
  - 脚本
tags:
  - 脚本
---
# 脚本创建动画

## 动画基础介绍
在脚本中，您可以使用两种方式创建动画：
1. **Animation** - 单个属性动画
2. **AnimationSet** - 多个动画的组合（同时或顺序播放）

## Animation 单动画

### Animation 构造函数
```javascript
// 方法1：使用new Animation()创建
// 参数：属性名, 值1, 值2, 值3...（至少2个值）
var animation1 = new Animation('scaleX', 0.5, 1.0);
var animation2 = new Animation('translateY', 0, 100, 200, 150);
var animation3 = new Animation('rotateZ', 0, 90, 180);

// 方法2：使用animate()函数创建
// 先指定属性，再配置其他参数
var animation4 = animate('opacity')
  .values(0, 1)  // 从完全透明到完全不透明
  .duration(1000)
  .start();
```

### Animation 所有可用属性和方法

#### 基础属性设置方法
```javascript
.values(值1, 值2, 值3, ...)  // 设置动画值列表，至少需要2个值
.repeatCount(次数)           // 设置重复次数，0表示不重复，-1表示无限重复
.repeatMode('模式')          // 设置重复模式：'Restart'（重新开始）或'Reverse'（反向）
.duration(毫秒)              // 设置动画持续时间（毫秒）
.delay(毫秒)                 // 设置动画开始前的延迟时间（毫秒）
.autoCancel(布尔值)          // 设置是否自动取消（true/false）
.easing('曲线名称')          // 设置动画插值曲线
.repeat(布尔值)              // 设置是否重复播放，true为重复
.target(控件对象)            // 设置要应用动画的控件对象
```

#### 动画状态控制方法
```javascript
.start()                    // 开始运行动画
.pause()                    // 暂停动画
.resume()                   // 恢复暂停的动画
.cancel()                   // 取消动画
.reverse()                  // 倒放动画
.end()                      // 停止动画，直接到达终点值
.value() 或 .getValue()     // 获取动画当前值
```

#### 动画状态检查方法
```javascript
.isRunning()                // 检查动画是否正在运行（返回true/false）
.isStarted()               // 检查动画是否已经开始（返回true/false）
.isPaused()                // 检查动画是否已暂停（返回true/false）
```

#### 动画事件回调方法
```javascript
.onStart(函数)              // 动画开始时触发
.onEnd(函数)                // 动画结束时触发（无限重复的动画不会触发）
.onCancel(函数)             // 动画被取消时触发
.onUpdate(函数)             // 动画每帧更新时触发
.onRepeat(函数)             // 动画每次重复时触发
.onPause(函数)              // 动画被暂停时触发
.onResume(函数)             // 动画恢复播放时触发
```

#### 其他方法
```javascript
.currentPlayTime(毫秒)      // 设置当前播放时间点
```

### Animation 完整使用示例

#### 示例1：基本缩放动画
```javascript
// 创建水平缩放动画
var scaleAnim = new Animation('scaleX', 0.5, 1.0, 0.8, 1.0);
scaleAnim.duration(1000);
scaleAnim.easing('ease-in-out');
scaleAnim.repeat(true);
scaleAnim.onUpdate(function() {
    var currentValue = scaleAnim.value();
    Chat.send('当前scaleX值: ' + currentValue);
});
scaleAnim.onEnd(function() {
    Chat.send('缩放动画结束');
});
scaleAnim.target(button1);  // 应用到button1控件
scaleAnim.start();
```

#### 示例2：位移动画
```javascript
// 创建垂直移动动画
var moveAnim = animate('translateY')
  .values(0, 100, 50, 100)
  .duration(2000)
  .delay(500)
  .easing('ease-out')
  .repeatCount(2)
  .repeatMode('Reverse')
  .onStart(function() {
    Chat.send('位移动画开始');
  })
  .onUpdate(function() {
    Chat.send('当前位置: ' + moveAnim.value());
  })
  .onEnd(function() {
    Chat.send('位移动画结束');
  })
  .target(button2);  // 应用到button2控件

// 开始动画
moveAnim.start();
```

#### 示例3：控制动画状态
```javascript
// 创建旋转动画
var rotateAnim = new Animation('rotateZ', 0, 360);
rotateAnim.duration(3000);
rotateAnim.repeat(true);
rotateAnim.target(button3);

// 开始动画
rotateAnim.start();

// 2秒后暂停
setTimeout(function() {
    if (rotateAnim.isRunning()) {
        rotateAnim.pause();
        Chat.send('动画已暂停');
    }
}, 2000);

// 4秒后恢复
setTimeout(function() {
    if (rotateAnim.isPaused()) {
        rotateAnim.resume();
        Chat.send('动画已恢复');
    }
}, 4000);

// 6秒后取消
setTimeout(function() {
    rotateAnim.cancel();
    Chat.send('动画已取消');
}, 6000);
```

## AnimationSet 动画集合

### AnimationSet 构造函数
```javascript
// 方法1：创建时传入多个动画
var anim1 = new Animation('scaleX', 0.5, 1.0);
var anim2 = new Animation('scaleY', 0.5, 1.0);
var animationSet = new AnimationSet(anim1, anim2);

// 方法2：创建空集合，后续添加动画
var animationSet2 = new AnimationSet();
```

### AnimationSet 所有可用属性和方法

#### 动画管理方法
```javascript
.add(动画对象)              // 添加子动画到集合
.remove(动画对象)           // 从集合中移除子动画
.playMode('模式')           // 设置播放模式：'Together'（同时播放）或'Sequentially'（顺序播放）
```

#### 链式配置方法
```javascript
.play(动画)                // 设置第一个动画
.with(动画)                // 与上一个动画同时播放
.before(动画)              // 在上一个动画之前播放
.after(动画)               // 在上一个动画之后播放
```

#### 控制方法
```javascript
.start()                   // 开始播放动画集合
```

### AnimationSet 完整使用示例

#### 示例1：同时播放多个动画
```javascript
// 创建3个不同的动画
var scaleXAnim = new Animation('scaleX', 1, 1.5);
scaleXAnim.duration(1000);

var scaleYAnim = new Animation('scaleY', 1, 1.5);
scaleYAnim.duration(1000);

var fadeAnim = new Animation('opacity', 1, 0.5, 1);
fadeAnim.duration(1000);

// 创建动画集合（同时播放）
var togetherSet = new AnimationSet(scaleXAnim, scaleYAnim, fadeAnim);
togetherSet.playMode('Together');  // 三个动画同时播放
togetherSet.target(button4);       // 应用到button4控件
togetherSet.start();
```

#### 示例2：顺序播放动画
```javascript
// 创建3个动画
var moveRight = new Animation('translateX', 0, 100);
moveRight.duration(500);

var moveDown = new Animation('translateY', 0, 100);
moveDown.duration(500);

var rotate = new Animation('rotateZ', 0, 360);
rotate.duration(500);

// 使用链式配置顺序播放
var sequentialSet = new AnimationSet();
sequentialSet.playMode('Sequentially');  // 顺序播放
sequentialSet
  .play(moveRight)    // 第一步：向右移动
  .with(rotate)       // 同时旋转（因为playMode是Sequentially，这里会等moveRight完成）
  .after(moveDown)    // 第二步：向下移动
  .target(button5)    // 应用到button5控件
  .start();
```

#### 示例3：动态管理动画集合
```javascript
// 创建动画
var anim1 = new Animation('scaleX', 1, 2);
anim1.duration(1000);

var anim2 = new Animation('scaleY', 1, 2);
anim2.duration(1000);

var anim3 = new Animation('opacity', 1, 0.5);
anim3.duration(1000);

// 创建集合
var dynamicSet = new AnimationSet(anim1, anim2);
dynamicSet.playMode('Together');
dynamicSet.target(button6);

// 开始播放
dynamicSet.start();

// 播放过程中添加新动画
setTimeout(function() {
    dynamicSet.add(anim3);  // 添加透明度动画
    Chat.send('添加了透明度动画');
}, 500);

// 移除动画
setTimeout(function() {
    dynamicSet.remove(anim2);  // 移除scaleY动画
    Chat.send('移除了scaleY动画');
}, 1500);
```

## 对象/数组方式创建动画

### 单个动画对象方式
```javascript
// 定义动画配置对象
var animationConfig = {
    property: 'scaleX',           // 动画属性
    values: [1, 1.5, 1],         // 值列表（数组）
    duration: 1000,              // 持续时间
    repeat: true,                // 是否重复
    easing: 'ease-in-out',       // 插值曲线
    onUpdate: function() {       // 更新回调
        Chat.send('动画更新中');
    },
    onEnd: function() {          // 结束回调
        Chat.send('动画结束');
    }
};

// 直接应用到控件
button7.play(animationConfig);
```

### 动画数组方式（同时播放）
```javascript
// 定义多个动画配置的数组
var animationsArray = [
    {
        property: 'scaleX',
        values: [1, 1.5],
        duration: 1000,
        easing: 'ease-in'
    },
    {
        property: 'translateY',
        values: [0, 100],
        duration: 1000,
        easing: 'ease-out',
        onUpdate: function() {
            Chat.send('Y轴位置更新');
        }
    },
    {
        property: 'rotateZ',
        values: [0, 180, 360],
        duration: 1500,
        repeat: true
    }
];

// 应用到控件（所有动画同时播放）
button8.play(animationsArray);
```

### 混合使用示例
```javascript
// 创建多个动画对象
var fadeInAnim = {
    property: 'opacity',
    values: [0, 1],
    duration: 800,
    easing: 'ease-in'
};

var slideUpAnim = {
    property: 'translateY',
    values: [100, 0],
    duration: 800,
    easing: 'ease-out'
};

var scaleAnim = {
    property: 'scale',
    values: [0.8, 1],
    duration: 800,
    easing: 'ease-in-out'
};

// 同时应用三个动画
var allAnimations = [fadeInAnim, slideUpAnim, scaleAnim];
button9.play(allAnimations);
```

## 动画曲线详解

### 线性曲线
```javascript
.easing('linear')  // 匀速运动
```

### 加速曲线（开始慢，结束快）
```javascript
.easing('ease-in')
.easing('easeInQuad')
.easing('accelerate')
```

### 减速曲线（开始快，结束慢）
```javascript
.easing('ease-out')
.easing('easeOutQuad')
.easing('decelerate')
```

### 加速减速曲线（两端慢，中间快）
```javascript
.easing('ease-in-out')
.easing('easeInOutSine')
.easing('accelerate-decelerate')
```

### 特殊效果曲线
```javascript
.easing('easeOutBack')      // 过冲效果
.easing('easeInBack')       // 前摇效果
.easing('bounce')           // 弹跳效果
.easing('spring')           // 弹簧效果
```

### 曲线使用示例
```javascript
// 使用弹跳曲线
var bounceAnim = new Animation('translateY', 0, 100);
bounceAnim.duration(1500);
bounceAnim.easing('bounce');
bounceAnim.repeat(true);
bounceAnim.target(button10);
bounceAnim.start();

// 使用弹簧曲线
var springAnim = {
    property: 'scaleX',
    values: [1, 1.5, 1],
    duration: 2000,
    easing: 'spring',
    repeat: true
};
button11.play(springAnim);
```

## 内置动画效果

### 直接使用内置动画
内置动画可以直接通过名称调用，支持以下三种命名格式：
```javascript
// 三种写法都支持
控件名.play('rubber_band');   // 下划线风格（推荐）
控件名.play('rubberBand');    // 驼峰风格
控件名.play('RubberBand');    // 首字母大写
```

### 内置动画分类

#### Attension 注意力动画
```javascript
button.play('flash');        // 闪烁
button.play('pulse');        // 脉搏
button.play('rubber_band');  // 橡皮筋
button.play('shake');        // 抖动
button.play('swing');        // 摇摆
button.play('wobble');       // 摇晃
button.play('bounce');       // 弹跳
button.play('tada');         // 喝彩
button.play('stand_up');     // 站立
button.play('wave');         // 挥手
```

#### 淡入淡出动画
```javascript
// 淡入
button.play('fade_in');           // 淡入
button.play('fade_in_up');        // 向上淡入
button.play('fade_in_down');      // 向下淡入
button.play('fade_in_left');      // 向左淡入
button.play('fade_in_right');     // 向右淡入

// 淡出
button.play('fade_out');          // 淡出
button.play('fade_out_up');       // 向上淡出
button.play('fade_out_down');     // 向下淡出
button.play('fade_out_left');      // 向左淡出
button.play('fade_out_right');     // 向右淡出
```

#### 缩放动画
```javascript
// 缩放进入
button.play('zoom_in');           // 缩放进入
button.play('zoom_in_down');      // 向下缩放进入
button.play('zoom_in_left');      // 向左缩放进入
button.play('zoom_in_right');     // 向右缩放进入
button.play('zoom_in_up');        // 向上缩放进入

// 缩放退出
button.play('zoom_out');          // 缩放退出
button.play('zoom_out_down');     // 向下缩放退出
button.play('zoom_out_left');     // 向左缩放退出
button.play('zoom_out_right');    // 向右缩放退出
button.play('zoom_out_up');       // 向上缩放退出
```

#### 滑动动画
```javascript
// 滑动进入
button.play('slide_in_left');     // 从左滑入
button.play('slide_in_right');    // 从右滑入
button.play('slide_in_up');       // 从上滑入
button.play('slide_in_down');     // 从下滑入

// 滑动退出
button.play('slide_out_left');    // 向左滑出
button.play('slide_out_right');   // 向右滑出
button.play('slide_out_up');      // 向上滑出
button.play('slide_out_down');    // 向下滑出
```

#### 旋转动画
```javascript
// 旋转进入
button.play('rotate_in');                // 旋转进入
button.play('rotate_in_down_left');      // 从左下旋转进入
button.play('rotate_in_down_right');     // 从右下旋转进入
button.play('rotate_in_up_left');        // 从左下旋转进入
button.play('rotate_in_up_right');       // 从右下旋转进入

// 旋转退出
button.play('rotate_out');               // 旋转退出
button.play('rotate_out_down_left');     // 向左下旋转退出
button.play('rotate_out_down_right');    // 向右下旋转退出
button.play('rotate_out_up_left');       // 向左上旋转退出
button.play('rotate_out_up_right');      // 向右上旋转退出
```

#### 翻转动画
```javascript
button.play('flip_in_x');      // X轴翻转进入
button.play('flip_in_y');      // Y轴翻转进入
button.play('flip_out_x');     // X轴翻转退出
button.play('flip_out_y');     // Y轴翻转退出
```

#### 特殊动画
```javascript
button.play('hinge');          // 铰链效果
button.play('roll_in');        // 滚入
button.play('roll_out');       // 滚出
button.play('landing');        // 着陆
button.play('taking_off');     // 起飞
button.play('drop_out');       // 掉落
```

### 内置动画使用示例

```javascript
// 示例1：页面加载时的入场动画
function pageLoadAnimations() {
    // 标题橡皮筋效果
    titleLabel.play('rubber_band');
    
    // 按钮依次弹入
    setTimeout(function() {
        button1.play('bounce_in_up');
    }, 200);
    
    setTimeout(function() {
        button2.play('bounce_in_up');
    }, 400);
    
    setTimeout(function() {
        button3.play('bounce_in_up');
    }, 600);
}

// 示例2：按钮点击反馈
button.on('click', function() {
    // 点击时轻微缩放
    button.play('pulse');
    
    // 或者使用橡皮筋效果
    // button.play('rubber_band');
});

// 示例3：切换页面时的过渡
function switchPage() {
    // 当前页面滑出
    currentPage.play('slide_out_left');
    
    // 新页面滑入
    setTimeout(function() {
        newPage.play('slide_in_right');
    }, 300);
}

// 示例4：错误提示动画
function showError(message) {
    errorLabel.text = message;
    errorLabel.play('shake');  // 抖动效果引起注意
    
    // 3秒后淡出
    setTimeout(function() {
        errorLabel.play('fade_out');
    }, 3000);
}
```

## 内置过渡动画

### 淡入淡出过渡
```javascript
// 应用到页面或控件
element.play('fade_in');    // 淡入
element.play('fade_out');   // 淡出
```

### 滑动过渡
```javascript
element.play('slide_left');     // 向左滑动
element.play('slide_top');      // 向上滑动
element.play('slide_right');    // 向右滑动
element.play('slide_bottom');   // 向下滑动
element.play('slide_start');    // 向开始方向滑动
element.play('slide_end');      // 向结束方向滑动
```

### 爆炸过渡
```javascript
element.play('explode_circular');      // 圆形爆炸
element.play('explode_side_left');     // 从左侧爆炸
element.play('explode_side_top');      // 从顶部爆炸
element.play('explode_side_right');    // 从右侧爆炸
element.play('explode_side_bottom');   // 从底部爆炸
element.play('explode_side_start');    // 从开始方向爆炸
element.play('explode_side_end');      // 从结束方向爆炸
```

## 综合实践示例

### 示例1：加载动画
```javascript
function createLoadingAnimation(loadingText) {
    // 创建加载文字动画
    var textAnim = new Animation('opacity', 0.3, 1, 0.3);
    textAnim.duration(1500);
    textAnim.repeat(true);
    textAnim.target(loadingText);
    
    // 创建加载图标旋转动画
    var iconAnim = new Animation('rotateZ', 0, 360);
    iconAnim.duration(1000);
    iconAnim.repeat(true);
    iconAnim.target(loadingIcon);
    
    // 同时播放
    var loadingSet = new AnimationSet(textAnim, iconAnim);
    loadingSet.playMode('Together');
    loadingSet.start();
    
    // 返回动画集合以便控制
    return loadingSet;
}

// 使用示例
var loadingAnim = createLoadingAnimation(loadingLabel);
// 加载完成后停止
setTimeout(function() {
    loadingAnim.cancel();
    loadingLabel.play('fade_out');
    loadingIcon.play('fade_out');
}, 5000);
```

### 示例2：按钮交互反馈
```javascript
function createInteractiveButton(button) {
    // 鼠标移入动画
    button.on('mouseenter', function() {
        button.play({
            property: 'scale',
            values: [1, 1.1],
            duration: 200,
            easing: 'ease-out'
        });
    });
    
    // 鼠标移出动画
    button.on('mouseleave', function() {
        button.play({
            property: 'scale',
            values: [1.1, 1],
            duration: 200,
            easing: 'ease-in'
        });
    });
    
    // 点击动画
    button.on('click', function() {
        // 先快速缩小
        button.play({
            property: 'scale',
            values: [1, 0.9, 1],
            duration: 300,
            easing: 'ease-in-out'
        });
        
        // 同时改变颜色
        button.play({
            property: 'backgroundColor',
            values: ['#4CAF50', '#45a049', '#4CAF50'],
            duration: 300
        });
    });
}
```

### 示例3：列表项动画
```javascript
function animateListItems(listContainer) {
    var items = listContainer.children;
    var delay = 0;
    
    for (var i = 0; i < items.length; i++) {
        (function(item, index) {
            // 设置初始状态
            item.style.opacity = 0;
            item.style.transform = 'translateY(20px)';
            
            // 延迟执行动画
            setTimeout(function() {
                item.play([
                    {
                        property: 'opacity',
                        values: [0, 1],
                        duration: 500,
                        easing: 'ease-in'
                    },
                    {
                        property: 'translateY',
                        values: [20, 0],
                        duration: 500,
                        easing: 'ease-out'
                    }
                ]);
            }, delay);
            
            delay += 100; // 每个项目延迟100毫秒
        })(items[i], i);
    }
}
```

## 注意事项

1. **性能优化**：避免同时运行过多动画，特别是在低性能设备上
2. **内存管理**：动画结束后及时清理，特别是重复动画和无限动画
3. **兼容性**：确保动画属性是控件支持的属性
4. **回调函数**：在回调函数中避免执行耗时操作
5. **错误处理**：使用try-catch包裹可能出错的动画代码

## 调试技巧

```javascript
// 调试动画值
var debugAnim = new Animation('translateX', 0, 100);
debugAnim.onUpdate(function() {
    Chat.send('当前值: ' + debugAnim.value() + ' 是否运行: ' + debugAnim.isRunning());
});

// 检查动画状态
if (anim.isRunning()) {
    Chat.send('动画正在运行');
} else if (anim.isPaused()) {
    Chat.send('动画已暂停');
} else if (anim.isStarted()) {
    Chat.send('动画已开始但未运行');
} else {
    Chat.send('动画未开始');
}
```