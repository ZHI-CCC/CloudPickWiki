# 扩展槽位

> 💡 该功能可以新增扩展槽位，同时可以自定义槽位限制放入功能。

> 📁 在 `config/SlotConfig.yml` 中设置。

## 配置示例

```yaml
# 自定义的槽位必须填在此处，否则槽位将不允许点击操作
额外槽位1: # ID，不能重复!
  # 本槽位是否启用属性兼容
  attribute: true
  # 本槽位是否启用时装兼容
  skin: true
  # 自定义槽位限制放入功能
  limit:
    # 自带条件
    # lorecontains|xxx   可以限制物品某行lore包含 xxx 才能放入【这个是要求某行lore包含指定文本就行】
    # lore|xxx   可以限制物品需要有 xxx 这个lore才能放入【这个是要求完整匹配整行lore的】
    # permission|xxx  可以限制玩家需要有 xxx 权限才可以放入
    # skin|xxx   可以限制物品的时装类型必须是 xxx 才能放入,xxx若为*则是个时装都可以放入【此选项需要龙之时装付费版才可使用】
    # emptyslot|xxx   可以限制只有当槽位xxx没有物品时，这个槽位才能放入
    - "lore|吊坠"
    - "permission|essentials.use"
```

---

## 限制条件脚本

> 💡 限制条件脚本，可以自己编写条件，需要有一定的 JavaScript 水平。
> [JavaScript 教程 | 菜鸟教程](https://www.runoob.com/js/js-tutorial.html)

以下是插件自带的限制条件脚本示例，您可以参考它们来编写自己的逻辑。

```yaml
# 脚本功能，不会改的不要乱改哦~
Script:
  # 用于判断物品的某行lore里是否包含了xxx
  lorecontains: |-
    function execute(player, itemStack, slotIdentifier, limitString){
      limitString = limitString.replaceAll("&","§");
      var lore = itemStack.getItemMeta().getLore();
      if(lore!=null){
        for(var i=0;i<lore.size();i++){
          var line = lore.get(i).replaceAll(" ","");
          if(line!=null && line.contains(limitString)){
             return true;
          }
        }
      }
      player.sendMessage("§c进不去!§b怎么想都进不去吧!§6要§5"+limitString+"§6才能进去!§8(槽位与物品不符)");
      return false;
    }
  # 用于判断物品是否有一行lore为xxx
  lore: |-
    function execute(player, itemStack, slotIdentifier, limitString){
      limitString = limitString.replaceAll("&","§");
      var lore = itemStack.getItemMeta().getLore();
      var result = lore != null && lore.contains(limitString);
      if(!result){
      player.sendMessage("§c该槽位需要Lore: "+limitString);
      }
      return result;
    }
  # 用于判断玩家是否拥有权限xxx
  permission: |-
    function execute(player, itemStack, slotIdentifier, limitString){
      var result = player.hasPermission(limitString);
      if(!result){
      player.sendMessage("§c进不去!§b怎么想都进不去吧!§6要§5"+limitString+" §6权限才能让你进去§8(缺少必要权限)")
      }
      return result;
    }
  # 用于判断玩家放入的时装是否为xx
  skin: |-
    function execute(player, itemStack, slotIdentifier, limitString) {
        var itemSkinType = DragonAPI.static.getItemSkinType(itemStack);
        if (itemSkinType != null) {
            itemSkinType = itemSkinType.toLowerCase();
        }
        var result = (itemSkinType === limitString) || (itemSkinType != null && limitString=="*");
        if (!result) {
            player.sendMessage("§c当前槽位需要时装类型: §f" + limitString + "§c  你放入的物品时装类型是: §f" + itemSkinType);
        }
        return result;
    }
  # 用于判断其他槽位内是否不存在物品
  emptyslot: |-
    function execute(player, itemStack, slotIdentifier, limitString) {
        var item = SlotAPI.static.getCacheSlotItem(player,limitString);
        var result = item == null || item.getType().toString() == "AIR";
        if(!result){
            if(limitString=="额外槽位1"){
               limitString = "英文名的话可以通过这个方式改成中文名提示玩家";
            }else if(limitString=="额外槽位2"){
               limitString = "英文名的话可以通过这个方式改成中文名提示玩家2333";
            }
            player.sendMessage("§c进不去!§b怎么想都进不去吧!§5" + limitString + "§6已经进去了!§8(您不能同时在两个槽位内放置物品)");
        }
        return result;
    }
  # 应用物品到原版槽位 比如放到该扩展槽位，原版人物显示副手 盔甲等
  applyVanilla: |-
    function execute(player, itemStack, slotIdentifier, limitString) {
      var result = false;
      limitString = limitString.replaceAll("&","§");
      var lore = itemStack.getItemMeta().getLore();
      if(lore!=null){
        for(var i=0;i<lore.size();i++){
          var line = lore.get(i).replaceAll(" ","");
          if(line!=null && line.contains(limitString)){
             result = true;
          }
        }
      }
      if(result){
        player.getInventory().setItemInOffHand(itemStack);   //设置副手
      }
      return result;
    }
```

---

## 如何扩展新的限制条件？

要添加自定义的槽位限制条件，您需要具备一定的 JavaScript 基础。扩展过程主要分为三步：

**第一步：在 `Script` 部分定义新的限制条件**

在 `SlotConfig.yml` 的 `Script` 部分，添加一个新的条件。条件的键名就是您自定义的限制条件名称（例如 `namecontains`）。

```yaml
Script:
  # ... (保留原有的 lore, permission 等) ...

  # 新增一个用于检测物品名称的条件
  namecontains: |-
    function execute(player, itemStack, slotIdentifier, limitString){
      // 这里是你的逻辑代码
    }
```

**第二步：编写 JavaScript 逻辑**

在新增的条件下，编写 `execute` 函数。这个函数会在玩家尝试放入物品时被调用，并且必须返回 `true` (允许放入) 或 `false` (禁止放入)。

函数包含四个参数：
*   `player`: 执行操作的玩家对象。
*   `itemStack`: 尝试放入的物品对象。
*   `slotIdentifier`: 目标槽位的 ID (例如 "额外槽位1")。
*   `limitString`: 在槽位 `limit` 配置中，跟在 `|` 后面的字符串。

**示例：** 编写一个检查物品显示名称是否包含特定文字的脚本。

```yaml
  namecontains: |-
    function execute(player, itemStack, slotIdentifier, limitString){
      // 检查物品是否有显示名称
      if (!itemStack.getItemMeta().hasDisplayName()) {
        player.sendMessage("§c物品没有名称，无法放入！");
        return false;
      }
      
      // 获取物品显示名称
      var displayName = itemStack.getItemMeta().getDisplayName();
      
      // 判断名称是否包含 limitString 指定的文本
      if (displayName.contains(limitString)) {
        return true; // 包含，允许放入
      } else {
        // 不包含，发送提示消息并禁止放入
        player.sendMessage("§c物品名称不正确！需要包含 '§e" + limitString + "§c' 字样。");
        return false;
      }
    }
```

**第三步：在槽位配置中应用新条件**

在您想要应用这个限制的槽位下，找到 `limit` 列表，并添加您的新条件。格式为 `条件名|参数`。

```yaml
额外槽位2:
  attribute: true
  skin: false
  limit:
    # 应用我们刚刚创建的 namecontains 条件
    # 要求放入的物品名称必须包含 "神器" 两个字
    - "namecontains|神器"
```